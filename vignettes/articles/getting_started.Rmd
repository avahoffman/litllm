---
title: "Getting Started"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  eval = FALSE,
  comment = "#>"
)
```

Load `litllm` and `tidyverse` (for some wrangling):

```{r setup}
library(litllm)
library(tidyverse)
```

## Setup

`litllm` uses the OpenAI API. You'll need an API key and internet connection to use it. 

_‚ö†Ô∏è The OpenAI API costs money. It is very cheap (around $0.60 for analyzing 100 pdfs), but you'll need to add credits through their interface._

Check that you have an API key saved in your environment:

```{r}
ll_check_api_key()
```

```
#> Looks like you have a key stored!üéâ
#> If you are having issues later, the key could be entered incorrectly or may no longer be active on OpenAI's API interface.
```

The first thing you'll want to do is locate your pdf file(s). Let's start with one file, then we'll show you how to do multiple files.

Download this file and ensure it's in your working directory:

```{r}
download.file(
  url = "https://www.annualreviews.org/docserver/fulltext/genom/25/1/annurev-genom-021623-081639.pdf?expires=1731900753&id=id&accname=guest&checksum=AC39C6258EF7E19E7426CB44F2B37958",
  destfile = "Taylor_etal.pdf"
  )
list.files(pattern = "pdf")
```

```
#> [1]"Taylor_etal.pdf"
```

## Mining Publication Metadata

Let's get basic information: title, year, and journal name.

```{r}
journal_metadata <- ll_extract_journals("Taylor_etal.pdf")
glimpse(journal_metadata)
```

```
#> Rows: 1
#> Columns: 4
#> $ paper_id <chr> "Taylor_etal.pdf"
#> $ title    <chr> "Beyond the Human Genome Project: The Age of Complete Human Genome Sequences and Pangenome References"
#> $ year     <chr> "2024"
#> $ journal  <chr> "Annual Review of Genomics and Human Genetics"
```

‚û° _This function supports caching, which hopefully saves you time and query costs! You can delete or relocate the cached file to rerun from scratch._

### LLMs Aren't perfect!

‚ö†Ô∏è _We recommend **checking your data regularly** for anything that doesn't make sense. LLMs like ChatGPT can save time, but they definitely make mistakes. You don't want to end up with a journal entitled "Johns Hopkins University"!_

## Mining Authors and Institutions

Let's obtain the authors and their institutions.

`ll_extract_authors()` produces a tibble with a column "paper_id" (the file name), "title" (the article title), and "auth" (individual author information). Each author will be on a separate row.

```{r}
authors <- ll_extract_authors("Taylor_etal.pdf")
glimpse(authors)
```

```
#> Rows: 11
#> Columns: 3
#> $ paper_id <chr> "Taylor_etal.pdf", "Taylor_etal.pdf", "Taylor_etal.pdf", "Ta‚Ä¶
#> $ title    <chr> "Beyond the Human Genome Project: The Age of Complete Human ‚Ä¶
#> $ auth     <chr> "Dylan J. Taylor, Department of Biology, Johns Hopkins Unive‚Ä¶
```

```{r}
head(authors)
```

```
#>          paper_id                                                                                                title
#> 1 Taylor_etal.pdf Beyond the Human Genome Project: The Age of Complete Human Genome Sequences and Pangenome References
#> 2 Taylor_etal.pdf Beyond the Human Genome Project: The Age of Complete Human Genome Sequences and Pangenome References
#> 3 Taylor_etal.pdf Beyond the Human Genome Project: The Age of Complete Human Genome Sequences and Pangenome References
#> 4 Taylor_etal.pdf Beyond the Human Genome Project: The Age of Complete Human Genome Sequences and Pangenome References
#> 5 Taylor_etal.pdf Beyond the Human Genome Project: The Age of Complete Human Genome Sequences and Pangenome References
#> 6 Taylor_etal.pdf Beyond the Human Genome Project: The Age of Complete Human Genome Sequences and Pangenome References
#>                                                                                                                         auth
#> 1                                 Dylan J. Taylor, Department of Biology, Johns Hopkins University, Baltimore, Maryland, USA
#> 2                               Jordan M. Eizenga, Genomics Institute, University of California, Santa Cruz, California, USA
#> 3                              Qiuhui Li, Department of Computer Science, Johns Hopkins University, Baltimore, Maryland, USA
#> 4                               Arun Das, Department of Computer Science, Johns Hopkins University, Baltimore, Maryland, USA
#> 5 Katharine M. Jenike, Department of Genetic Medicine, Johns Hopkins University School of Medicine, Baltimore, Maryland, USA
#> 6                  Eimear E. Kenny, Institute for Genomic Health, Icahn School of Medicine at Mount Sinai, New York, NY, USA
```

### Getting Raw Author Data

You can view the data in raw format as well.

```{r}
authors_raw <- ll_extract_authors("Taylor_etal.pdf", clean_authors = F)
authors_raw
```

```
#> $Taylor_etal.pdf
#> [1] "Title: Beyond the Human Genome Project: The Age of Complete Human Genome Sequences and Pangenome References\n\nAuthor(s):\nDylan J. 
#> Taylor, Department of Biology, Johns Hopkins University, Baltimore, Maryland, USA\nJordan M. Eizenga, Genomics Institute, University of 
#> California, Santa Cruz...
```

‚û° _This function supports caching, which hopefully saves you time and query costs! You can delete or relocate the cached file to rerun from scratch._

## Getting Institution Information

We might be interested in information about the institutions. But first let's limit it to unique institutions.

```{r}
distinct_institutions <- unique(authors$inst)
```

```
#> [1] "Johns Hopkins University"
#> [2] "University of California, Santa Cruz"
#> [3] "Johns Hopkins University School of Medicine"
#> [4] "Icahn School of Medicine at Mount Sinai"
#> [5] "Institut de Recherche en Sant√© Digestive, Universit√© de Toulouse, INSERM, INRA, ENVT, UPS"
```

### Logical Queries for Institutions 

Let's see if these institutions have a large student body. Any institutional discriptor can be inserted for the `logical_check` argument.

```{r}
is_large <-
  ll_check_institution_type(
    distinct_institutions,
    logical_check = "an institution with >5000 students"
    )
is_large
```

```
#> # A tibble: 5 √ó 2
#>   name                                          an_institution_with_‚Ä¶¬π
#>   <chr>                                         <chr>
#> 1 Johns Hopkins University                      TRUE
#> 2 University of California, Santa Cruz          TRUE
#> 3 Johns Hopkins University School of Medicine   FALSE
#> 4 Icahn School of Medicine at Mount Sinai       FALSE
#> 5 Institut de Recherche en Sant√© Digestive, Un‚Ä¶ FALSE
#> # ‚Ñπ abbreviated name: ¬π‚Äãan_institution_with_5000_students
```

### Combining `litllm` Data

Join to `authors` to build your dataset!

```{r}
authors <- authors %>% left_join(is_large, by = c("inst" = "name"))
```

```
#> Rows: 11
#> Columns: 5
#> $ paper_id                          <chr> "Taylor_etal.pdf", "Taylor_etal.pd‚Ä¶
#> $ title                             <chr> "Beyond the Human Genome Project: ‚Ä¶
#> $ auth                              <chr> "Dylan J. Taylor, Department of Bi‚Ä¶
#> $ inst                              <chr> "Johns Hopkins University", "Unive‚Ä¶
#> $ an_institution_with_5000_students <chr> "TRUE", "TRUE", "TRUE", "TRUE", "F‚Ä¶
```
